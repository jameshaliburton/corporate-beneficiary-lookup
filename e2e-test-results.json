{
  "timestamp": "2025-08-29T07:52:10.607Z",
  "summary": {
    "totalTests": 8,
    "successfulTests": 2,
    "failedTests": 6
  },
  "results": {
    "EnhancedAgentOwnershipResearch": {
      "result": {
        "financial_beneficiary": "Unilever PLC",
        "beneficiary_country": "United Kingdom",
        "beneficiary_flag": "🇬🇧",
        "ownership_structure_type": "Joint Venture",
        "confidence_score": 95,
        "confidence_level": "Very High",
        "sources": [
          "LLM analysis of Lipton"
        ],
        "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
        "ownership_flow": [
          {
            "name": "Lipton",
            "type": "Brand",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": false
          },
          {
            "name": "Pepsi Lipton International",
            "type": "Joint Venture",
            "country": "United States",
            "flag": "🇺🇸",
            "ultimate": false
          },
          {
            "name": "Unilever PLC",
            "type": "Ultimate Owner",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": true
          }
        ],
        "web_research_used": false,
        "web_sources_count": 0,
        "query_analysis_used": false,
        "static_mapping_used": false,
        "result_type": "llm_first_analysis",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453822001_yquiraa7b",
          "start_time": "2025-08-29T07:50:22.001Z",
          "brand": "Lipton",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453822003",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:50:22.003Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:22.761Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:50:22.761Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 758,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:22.761Z"
            },
            {
              "stage_id": "sheets_mapping_1756453823463",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:50:23.463Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:24.151Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:24.151Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 688,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:24.151Z"
            },
            {
              "stage_id": "static_mapping_1756453824828",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:50:24.828Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:25.512Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:25.716Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 888,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:25.716Z"
            },
            {
              "stage_id": "rag_retrieval_1756453826519",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:50:26.519Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:27.187Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:27.302Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 783,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:27.302Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453827974",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:50:27.974Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:28.656Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:38.047Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
                },
                "LLM-first analysis successful with high confidence"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:50:38.047Z",
                  "decision": "Use LLM-first result",
                  "alternatives": [
                    "Proceed with web research"
                  ],
                  "reasoning": "LLM analysis provides high-confidence result"
                }
              ],
              "data": {
                "financial_beneficiary": "Unilever PLC",
                "confidence_score": 95,
                "method": "llm_first_high_confidence"
              },
              "error": null,
              "duration_ms": 10073,
              "variables": {
                "inputVariables": {
                  "brand": "Lipton",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "Unilever PLC",
                  "beneficiary_country": "United Kingdom",
                  "ownership_structure_type": "Joint Venture",
                  "confidence_score": 95,
                  "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
                  "ownership_flow": [
                    {
                      "name": "Lipton",
                      "type": "Brand",
                      "country": "United Kingdom",
                      "source": "historical knowledge"
                    },
                    {
                      "name": "Pepsi Lipton International",
                      "type": "Joint Venture",
                      "country": "United States",
                      "source": "corporate filings"
                    },
                    {
                      "name": "Unilever PLC",
                      "type": "Ultimate Owner",
                      "country": "United Kingdom",
                      "source": "corporate structure records"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1543,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: Lipton\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:50:38.047Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:50:38.047Z",
              "decision": "Use LLM-first result",
              "alternatives": [
                "Proceed with web research"
              ],
              "reasoning": "LLM analysis provides high-confidence result"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:22.761Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:22.761Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:24.151Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: Lipton"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:24.151Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:25.512Z",
              "type": "info",
              "content": "Checking static mappings for brand: Lipton"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:25.716Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:50:27.187Z",
              "type": "info",
              "content": "Searching knowledge base for brand: Lipton"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:50:27.302Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:50:28.656Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: Lipton"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:50:38.047Z",
              "type": "analysis",
              "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 16819,
            "stage_durations": {
              "cache_check": 758,
              "sheets_mapping": 688,
              "static_mapping": 888,
              "rag_retrieval": 783,
              "llm_first_analysis": 10073
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 95,
        "agent_results": {
          "llm_first_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "Unilever PLC",
              "beneficiary_country": "United Kingdom",
              "ownership_structure_type": "Joint Venture",
              "ownership_flow": [
                {
                  "name": "Lipton",
                  "type": "Brand",
                  "country": "United Kingdom",
                  "source": "historical knowledge"
                },
                {
                  "name": "Pepsi Lipton International",
                  "type": "Joint Venture",
                  "country": "United States",
                  "source": "corporate filings"
                },
                {
                  "name": "Unilever PLC",
                  "type": "Ultimate Owner",
                  "country": "United Kingdom",
                  "source": "corporate structure records"
                }
              ],
              "confidence_score": 95,
              "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score."
            },
            "reasoning": "LLM-first analysis provided high-confidence ownership determination"
          }
        }
      },
      "issues": [
        "Agent reported failure"
      ],
      "observations": []
    },
    "EnhancedWebSearchOwnershipAgent": {
      "success": null,
      "result": null,
      "issues": [
        "Agent returned null/undefined"
      ],
      "observations": []
    },
    "NarrativeGeneratorV3": {
      "success": "That iconic yellow label tea brand isn't British or American as many think - Lipton is actually owned by Dutch-based consumer goods giant Unilever.",
      "result": {
        "headline": "Your Lipton tea? Actually Dutch! 🇳🇱",
        "tagline": "The famous tea brand is owned by Unilever in Netherlands",
        "story": "That iconic yellow label tea brand isn't British or American as many think - Lipton is actually owned by Dutch-based consumer goods giant Unilever.",
        "ownership_notes": [
          "Unilever is a Dutch-British multinational company",
          "Ownership confidence level: 85%",
          "Lipton is one of Unilever's billion-dollar brands"
        ],
        "behind_the_scenes": [
          "Original brand country data unavailable",
          "Ownership type information not provided",
          "High confidence (85%) in Unilever ownership",
          "Netherlands identified as ultimate owner country"
        ],
        "template_used": "surprise_origin"
      },
      "issues": [],
      "observations": [
        "Headline: Your Lipton tea? Actually Dutch! 🇳🇱",
        "Template: surprise_origin",
        "Country emphasis: Yes"
      ]
    },
    "Manual_Lipton": {
      "result": {
        "financial_beneficiary": "Unilever PLC",
        "beneficiary_country": "United Kingdom",
        "beneficiary_flag": "🇬🇧",
        "ownership_structure_type": "Joint Venture",
        "confidence_score": 95,
        "confidence_level": "Very High",
        "sources": [
          "LLM analysis of Lipton"
        ],
        "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
        "ownership_flow": [
          {
            "name": "Lipton",
            "type": "Brand",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": false
          },
          {
            "name": "Pepsi Lipton International",
            "type": "Joint Venture",
            "country": "United States",
            "flag": "🇺🇸",
            "ultimate": false
          },
          {
            "name": "Unilever PLC",
            "type": "Ultimate Owner",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": true
          }
        ],
        "web_research_used": false,
        "web_sources_count": 0,
        "query_analysis_used": false,
        "static_mapping_used": false,
        "result_type": "llm_first_analysis",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453855492_pxyfnhym3",
          "start_time": "2025-08-29T07:50:55.492Z",
          "brand": "Lipton",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453855492",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:50:55.492Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:56.170Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:50:56.170Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 678,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:56.170Z"
            },
            {
              "stage_id": "sheets_mapping_1756453856846",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:50:56.846Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:57.522Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:57.522Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 676,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:57.522Z"
            },
            {
              "stage_id": "static_mapping_1756453858206",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:50:58.206Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:58.894Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:59.007Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 801,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:59.007Z"
            },
            {
              "stage_id": "rag_retrieval_1756453859682",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:50:59.682Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:00.363Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:51:00.479Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 798,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:00.480Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453861164",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:51:01.164Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:01.843Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:51:11.653Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
                },
                "LLM-first analysis successful with high confidence"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:51:11.653Z",
                  "decision": "Use LLM-first result",
                  "alternatives": [
                    "Proceed with web research"
                  ],
                  "reasoning": "LLM analysis provides high-confidence result"
                }
              ],
              "data": {
                "financial_beneficiary": "Unilever PLC",
                "confidence_score": 95,
                "method": "llm_first_high_confidence"
              },
              "error": null,
              "duration_ms": 10489,
              "variables": {
                "inputVariables": {
                  "brand": "Lipton",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "Unilever PLC",
                  "beneficiary_country": "United Kingdom",
                  "ownership_structure_type": "Joint Venture",
                  "confidence_score": 95,
                  "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
                  "ownership_flow": [
                    {
                      "name": "Lipton",
                      "type": "Brand",
                      "country": "United Kingdom",
                      "source": "historical knowledge"
                    },
                    {
                      "name": "Pepsi Lipton International",
                      "type": "Joint Venture",
                      "country": "United States",
                      "source": "corporate filings"
                    },
                    {
                      "name": "Unilever PLC",
                      "type": "Ultimate Owner",
                      "country": "United Kingdom",
                      "source": "corporate structure records"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1543,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: Lipton\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:51:11.653Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:11.653Z",
              "decision": "Use LLM-first result",
              "alternatives": [
                "Proceed with web research"
              ],
              "reasoning": "LLM analysis provides high-confidence result"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:56.170Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:56.170Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:57.522Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: Lipton"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:57.522Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:58.894Z",
              "type": "info",
              "content": "Checking static mappings for brand: Lipton"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:59.007Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:00.363Z",
              "type": "info",
              "content": "Searching knowledge base for brand: Lipton"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:00.479Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:01.843Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: Lipton"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:11.653Z",
              "type": "analysis",
              "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 16939,
            "stage_durations": {
              "cache_check": 678,
              "sheets_mapping": 676,
              "static_mapping": 801,
              "rag_retrieval": 798,
              "llm_first_analysis": 10489
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 95,
        "agent_results": {
          "llm_first_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "Unilever PLC",
              "beneficiary_country": "United Kingdom",
              "ownership_structure_type": "Joint Venture",
              "ownership_flow": [
                {
                  "name": "Lipton",
                  "type": "Brand",
                  "country": "United Kingdom",
                  "source": "historical knowledge"
                },
                {
                  "name": "Pepsi Lipton International",
                  "type": "Joint Venture",
                  "country": "United States",
                  "source": "corporate filings"
                },
                {
                  "name": "Unilever PLC",
                  "type": "Ultimate Owner",
                  "country": "United Kingdom",
                  "source": "corporate structure records"
                }
              ],
              "confidence_score": 95,
              "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score."
            },
            "reasoning": "LLM-first analysis provided high-confidence ownership determination"
          }
        }
      },
      "issues": [
        "Pipeline reported failure"
      ],
      "observations": []
    },
    "Manual_IKEA": {
      "result": {
        "financial_beneficiary": "INGKA Foundation",
        "beneficiary_country": "Netherlands",
        "beneficiary_flag": "🇳🇱",
        "ownership_structure_type": "Foundation-owned Private Company",
        "confidence_score": 95,
        "confidence_level": "Very High",
        "sources": [
          "LLM analysis of IKEA"
        ],
        "reasoning": "IKEA has a complex ownership structure split between two main entities: The INGKA Foundation (which owns INGKA Holding B.V., operating most IKEA stores) and the Interogo Foundation (which owns the IKEA concept and brand rights through Inter IKEA Systems B.V.). The INGKA Foundation is considered the ultimate financial beneficiary as it controls the majority of IKEA's retail operations worldwide, representing about 90% of all IKEA stores. This structure was created by IKEA's founder Ingvar Kamprad for tax efficiency and to ensure long-term independence. The high confidence score is based on well-documented corporate structures and public records, though the complex nature of the organization means some details of internal ownership flows may vary.",
        "ownership_flow": [
          {
            "name": "IKEA",
            "type": "Brand",
            "country": "Sweden",
            "flag": "🇸🇪",
            "ultimate": false
          },
          {
            "name": "Inter IKEA Systems B.V.",
            "type": "Brand Owner",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": false
          },
          {
            "name": "Inter IKEA Holding B.V.",
            "type": "Parent Company",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": false
          },
          {
            "name": "Interogo Foundation",
            "type": "Brand Rights Owner",
            "country": "Liechtenstein",
            "flag": "🏳️",
            "ultimate": false
          },
          {
            "name": "INGKA Holding B.V.",
            "type": "Retail Operations",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": false
          },
          {
            "name": "INGKA Foundation",
            "type": "Ultimate Owner",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": true
          }
        ],
        "web_research_used": false,
        "web_sources_count": 0,
        "query_analysis_used": false,
        "static_mapping_used": false,
        "result_type": "llm_first_analysis",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453872431_ltczhujvz",
          "start_time": "2025-08-29T07:51:12.431Z",
          "brand": "IKEA",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453872431",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:51:12.431Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:13.115Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:51:13.115Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 684,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:13.115Z"
            },
            {
              "stage_id": "sheets_mapping_1756453873790",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:51:13.790Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:14.459Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:14.459Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 669,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:14.459Z"
            },
            {
              "stage_id": "static_mapping_1756453875128",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:51:15.128Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:15.808Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:15.895Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 767,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:15.895Z"
            },
            {
              "stage_id": "rag_retrieval_1756453876573",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:51:16.573Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:17.257Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:17.361Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 788,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:17.361Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453878075",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:51:18.075Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:18.748Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:29.434Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: INGKA Foundation (confidence: 95%)"
                },
                "LLM-first analysis successful with high confidence"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:51:29.434Z",
                  "decision": "Use LLM-first result",
                  "alternatives": [
                    "Proceed with web research"
                  ],
                  "reasoning": "LLM analysis provides high-confidence result"
                }
              ],
              "data": {
                "financial_beneficiary": "INGKA Foundation",
                "confidence_score": 95,
                "method": "llm_first_high_confidence"
              },
              "error": null,
              "duration_ms": 11359,
              "variables": {
                "inputVariables": {
                  "brand": "IKEA",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "INGKA Foundation",
                  "beneficiary_country": "Netherlands",
                  "ownership_structure_type": "Foundation-owned Private Company",
                  "confidence_score": 95,
                  "reasoning": "IKEA has a complex ownership structure split between two main entities: The INGKA Foundation (which owns INGKA Holding B.V., operating most IKEA stores) and the Interogo Foundation (which owns the IKEA concept and brand rights through Inter IKEA Systems B.V.). The INGKA Foundation is considered the ultimate financial beneficiary as it controls the majority of IKEA's retail operations worldwide, representing about 90% of all IKEA stores. This structure was created by IKEA's founder Ingvar Kamprad for tax efficiency and to ensure long-term independence. The high confidence score is based on well-documented corporate structures and public records, though the complex nature of the organization means some details of internal ownership flows may vary.",
                  "ownership_flow": [
                    {
                      "name": "IKEA",
                      "type": "Brand",
                      "country": "Sweden",
                      "source": "public records"
                    },
                    {
                      "name": "Inter IKEA Systems B.V.",
                      "type": "Brand Owner",
                      "country": "Netherlands",
                      "source": "corporate filings"
                    },
                    {
                      "name": "Inter IKEA Holding B.V.",
                      "type": "Parent Company",
                      "country": "Netherlands",
                      "source": "corporate structure documents"
                    },
                    {
                      "name": "Interogo Foundation",
                      "type": "Brand Rights Owner",
                      "country": "Liechtenstein",
                      "source": "corporate records"
                    },
                    {
                      "name": "INGKA Holding B.V.",
                      "type": "Retail Operations",
                      "country": "Netherlands",
                      "source": "corporate filings"
                    },
                    {
                      "name": "INGKA Foundation",
                      "type": "Ultimate Owner",
                      "country": "Netherlands",
                      "source": "corporate records"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1871,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: IKEA\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:51:29.434Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:29.434Z",
              "decision": "Use LLM-first result",
              "alternatives": [
                "Proceed with web research"
              ],
              "reasoning": "LLM analysis provides high-confidence result"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:13.115Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:13.115Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:14.459Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: IKEA"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:14.459Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:15.808Z",
              "type": "info",
              "content": "Checking static mappings for brand: IKEA"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:15.895Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:17.257Z",
              "type": "info",
              "content": "Searching knowledge base for brand: IKEA"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:17.361Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:18.748Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: IKEA"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:29.434Z",
              "type": "analysis",
              "content": "LLM analysis complete: INGKA Foundation (confidence: 95%)"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 17746,
            "stage_durations": {
              "cache_check": 684,
              "sheets_mapping": 669,
              "static_mapping": 767,
              "rag_retrieval": 788,
              "llm_first_analysis": 11359
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 95,
        "agent_results": {
          "llm_first_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "INGKA Foundation",
              "beneficiary_country": "Netherlands",
              "ownership_structure_type": "Foundation-owned Private Company",
              "ownership_flow": [
                {
                  "name": "IKEA",
                  "type": "Brand",
                  "country": "Sweden",
                  "source": "public records"
                },
                {
                  "name": "Inter IKEA Systems B.V.",
                  "type": "Brand Owner",
                  "country": "Netherlands",
                  "source": "corporate filings"
                },
                {
                  "name": "Inter IKEA Holding B.V.",
                  "type": "Parent Company",
                  "country": "Netherlands",
                  "source": "corporate structure documents"
                },
                {
                  "name": "Interogo Foundation",
                  "type": "Brand Rights Owner",
                  "country": "Liechtenstein",
                  "source": "corporate records"
                },
                {
                  "name": "INGKA Holding B.V.",
                  "type": "Retail Operations",
                  "country": "Netherlands",
                  "source": "corporate filings"
                },
                {
                  "name": "INGKA Foundation",
                  "type": "Ultimate Owner",
                  "country": "Netherlands",
                  "source": "corporate records"
                }
              ],
              "confidence_score": 95,
              "reasoning": "IKEA has a complex ownership structure split between two main entities: The INGKA Foundation (which owns INGKA Holding B.V., operating most IKEA stores) and the Interogo Foundation (which owns the IKEA concept and brand rights through Inter IKEA Systems B.V.). The INGKA Foundation is considered the ultimate financial beneficiary as it controls the majority of IKEA's retail operations worldwide, representing about 90% of all IKEA stores. This structure was created by IKEA's founder Ingvar Kamprad for tax efficiency and to ensure long-term independence. The high confidence score is based on well-documented corporate structures and public records, though the complex nature of the organization means some details of internal ownership flows may vary."
            },
            "reasoning": "LLM-first analysis provided high-confidence ownership determination"
          }
        }
      },
      "issues": [
        "Pipeline reported failure"
      ],
      "observations": []
    },
    "Manual_MooseMilk": {
      "result": {
        "financial_beneficiary": "MooseMilk",
        "beneficiary_country": "Canada",
        "beneficiary_flag": "🇨🇦",
        "ownership_structure_type": "Independent Brand",
        "ownership_flow": [
          {
            "name": "MooseMilk",
            "type": "Brand",
            "country": "Canada",
            "source": "web_search_analysis"
          }
        ],
        "confidence_score": 50,
        "confidence_level": "Medium",
        "confidence_factors": {
          "source_authority": 0,
          "source_recency": 0,
          "source_count": 0,
          "chain_completeness": 1
        },
        "confidence_breakdown": {
          "tier_1_sources": 0,
          "tier_2_sources": 0,
          "tier_3_sources": 0,
          "tier_4_sources": 0
        },
        "confidence_reasoning": "Based on 0 sources across 1 ownership levels",
        "sources": [],
        "reasoning": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information.",
        "verification_status": "unverified",
        "verification_reasoning": "Found 2 sources with 0 verified sources",
        "trusted_sources": [],
        "verified_sources": [],
        "highly_likely_sources": [],
        "agent_results": {
          "query_builder": {
            "success": true,
            "data": [
              {
                "query": "\"[object Object]\" parent company",
                "purpose": "find parent company information",
                "priority": 5,
                "expected_sources": [
                  "company websites",
                  "financial news"
                ]
              },
              {
                "query": "\"[object Object]\" ultimate owner",
                "purpose": "find ultimate ownership",
                "priority": 5,
                "expected_sources": [
                  "financial filings",
                  "corporate registries"
                ]
              }
            ],
            "reasoning": "Query builder analyzed brand characteristics and generated optimized search queries"
          },
          "web_research": {
            "success": true,
            "data": {
              "success": true,
              "brand": "MooseMilk",
              "product_name": null,
              "ownership_chain": [
                {
                  "name": "MooseMilk",
                  "role": "Brand",
                  "country": "Canada",
                  "flag": "🇨🇦",
                  "ultimate": false,
                  "sources": []
                }
              ],
              "final_confidence": 0.4,
              "sources": [
                {
                  "name": "Canadian Brand Association Database",
                  "url": "",
                  "type": "inference",
                  "reliability": 0.3
                },
                {
                  "name": "Dairy Industry Analysis",
                  "url": "",
                  "type": "analysis",
                  "reliability": 0.4
                }
              ],
              "verification_status": "unverified",
              "verification_reasoning": "Found 2 sources with 0 verified sources",
              "research_summary": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information.",
              "data_quality": {
                "completeness": 0.5,
                "recency": 0.5,
                "consistency": 0.5
              },
              "debug_info": {
                "research_rounds": 3,
                "best_round": "fallback_research",
                "strategy_used": {
                  "primary_approach": "registry_research",
                  "secondary_approaches": [
                    "news_research",
                    "corporate_structure"
                  ],
                  "language_priority": [
                    "en"
                  ],
                  "registry_focus": [],
                  "legal_suffixes": [
                    "Ltd",
                    "Inc",
                    "LLC"
                  ],
                  "industry_keywords": [
                    "beverage",
                    "dairy",
                    "food and drink"
                  ]
                }
              },
              "research_method": "llm_first_research",
              "total_sources": 2,
              "notes": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information.",
              "trusted_sources": [],
              "verified_sources": [],
              "highly_likely_sources": []
            },
            "reasoning": "LLM-first research provided high-confidence ownership determination"
          },
          "ownership_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "MooseMilk",
              "beneficiary_country": "Canada",
              "ownership_structure_type": "Independent Brand",
              "confidence_score": 50,
              "ownership_flow": [
                {
                  "name": "MooseMilk",
                  "type": "Brand",
                  "country": "Canada",
                  "source": "web_search_analysis"
                }
              ],
              "sources": [],
              "reasoning": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information."
            },
            "reasoning": "Ownership analysis completed using LLM research results"
          }
        },
        "web_research_used": true,
        "web_sources_count": 2,
        "query_analysis_used": true,
        "query_analysis": {},
        "static_mapping_used": false,
        "result_type": "llm_first_research",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453890177_922a30eu5",
          "start_time": "2025-08-29T07:51:30.177Z",
          "brand": "MooseMilk",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453890178",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:51:30.178Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:30.923Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:51:30.923Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 745,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:30.923Z"
            },
            {
              "stage_id": "sheets_mapping_1756453891588",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:51:31.588Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:32.270Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:32.270Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 682,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:32.270Z"
            },
            {
              "stage_id": "static_mapping_1756453892946",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:51:32.946Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:33.628Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:33.729Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 783,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:33.729Z"
            },
            {
              "stage_id": "rag_retrieval_1756453894421",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:51:34.421Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:35.102Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:35.240Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 819,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:35.240Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453895913",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:51:35.913Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:36.586Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:42.826Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: Unknown (confidence: 0%)"
                },
                {
                  "timestamp": "2025-08-29T07:51:42.826Z",
                  "type": "decision",
                  "content": "LLM confidence too low (0%), proceeding with web research"
                },
                "LLM-first analysis completed, proceeding with web research"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:51:42.826Z",
                  "decision": "Proceed with web research",
                  "alternatives": [
                    "Use LLM result"
                  ],
                  "reasoning": "LLM confidence insufficient for direct use"
                }
              ],
              "data": {
                "confidence_score": 0,
                "method": "llm_first_low_confidence",
                "llm_insights": {
                  "financial_beneficiary": "Unknown",
                  "beneficiary_country": "Unknown",
                  "ownership_structure_type": "Unknown",
                  "ownership_flow": [
                    {
                      "name": "MooseMilk",
                      "type": "Brand",
                      "country": "Unknown",
                      "source": "provided information"
                    }
                  ],
                  "confidence_score": 0,
                  "reasoning": "With only the brand name 'MooseMilk' provided and no additional context, product information, or barcode data, I cannot make any confident assertions about the ownership structure or ultimate financial beneficiary. The brand name suggests it might be related to dairy products and possibly of Canadian origin (due to the moose reference), but this would be pure speculation. Without additional information such as product packaging, corporate registration data, or verifiable market presence, I cannot determine the ownership structure or parent company. A thorough analysis would require more data points such as manufacturing location, distribution networks, trademark registrations, or corporate filings."
                }
              },
              "error": null,
              "duration_ms": 6913,
              "variables": {
                "inputVariables": {
                  "brand": "MooseMilk",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "Unknown",
                  "beneficiary_country": "Unknown",
                  "ownership_structure_type": "Unknown",
                  "confidence_score": 0,
                  "reasoning": "With only the brand name 'MooseMilk' provided and no additional context, product information, or barcode data, I cannot make any confident assertions about the ownership structure or ultimate financial beneficiary. The brand name suggests it might be related to dairy products and possibly of Canadian origin (due to the moose reference), but this would be pure speculation. Without additional information such as product packaging, corporate registration data, or verifiable market presence, I cannot determine the ownership structure or parent company. A thorough analysis would require more data points such as manufacturing location, distribution networks, trademark registrations, or corporate filings.",
                  "ownership_flow": [
                    {
                      "name": "MooseMilk",
                      "type": "Brand",
                      "country": "Unknown",
                      "source": "provided information"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1024,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: MooseMilk\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:51:42.826Z"
            },
            {
              "stage_id": "query_builder_1756453903507",
              "stage": "query_builder",
              "description": "Analyzing brand for optimal search queries",
              "start_time": "2025-08-29T07:51:43.507Z",
              "status": "error",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:44.185Z",
                  "type": "info",
                  "content": "Query builder available, generating optimized search queries"
                },
                {
                  "timestamp": "2025-08-29T07:51:44.187Z",
                  "type": "error",
                  "content": "Query builder failed: Cannot read properties of undefined (reading 'length')"
                },
                "Error: Cannot read properties of undefined (reading 'length')",
                "Query builder encountered an error"
              ],
              "decisions": [],
              "data": {},
              "error": null,
              "duration_ms": 680,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:44.187Z"
            },
            {
              "stage_id": "web_research_1756453904865",
              "stage": "web_research",
              "description": "Performing LLM-first ownership research",
              "start_time": "2025-08-29T07:51:44.865Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:45.540Z",
                  "type": "info",
                  "content": "LLM-first research available, attempting direct ownership determination"
                },
                "LLM-first research completed successfully"
              ],
              "decisions": [],
              "data": {
                "success": true,
                "total_sources": 2,
                "ownership_chain_length": 1,
                "final_confidence": 0.4,
                "research_method": "llm_first_research"
              },
              "error": null,
              "duration_ms": 25632,
              "variables": {
                "inputVariables": {
                  "brand": "MooseMilk",
                  "product_name": "Unknown product",
                  "hints": "{}",
                  "query_analysis": "[{\"query\":\"\\\"[object Object]\\\" parent company\",\"purpose\":\"find parent company information\",\"priority\":5,\"expected_sources\":[\"company websites\",\"financial news\"]},{\"query\":\"\\\"[object Object]\\\" ultimate owner\",\"purpose\":\"find ultimate ownership\",\"priority\":5,\"expected_sources\":[\"financial filings\",\"corporate registries\"]}]"
                },
                "outputVariables": {
                  "success": true,
                  "total_sources": 2,
                  "ownership_chain_length": 1,
                  "final_confidence": 0.4,
                  "research_method": "llm_first_research",
                  "notes": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information."
                },
                "intermediateVariables": {
                  "llm_research_available": true,
                  "evidence_tracked": 2
                }
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:52:10.497Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:42.826Z",
              "decision": "Proceed with web research",
              "alternatives": [
                "Use LLM result"
              ],
              "reasoning": "LLM confidence insufficient for direct use"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:30.923Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:30.923Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:32.270Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: MooseMilk"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:32.270Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:33.628Z",
              "type": "info",
              "content": "Checking static mappings for brand: MooseMilk"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:33.729Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:35.102Z",
              "type": "info",
              "content": "Searching knowledge base for brand: MooseMilk"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:35.240Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:36.586Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: MooseMilk"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:42.826Z",
              "type": "analysis",
              "content": "LLM analysis complete: Unknown (confidence: 0%)"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:42.826Z",
              "type": "decision",
              "content": "LLM confidence too low (0%), proceeding with web research"
            },
            {
              "stage": "query_builder",
              "timestamp": "2025-08-29T07:51:44.185Z",
              "type": "info",
              "content": "Query builder available, generating optimized search queries"
            },
            {
              "stage": "query_builder",
              "timestamp": "2025-08-29T07:51:44.187Z",
              "type": "error",
              "content": "Query builder failed: Cannot read properties of undefined (reading 'length')"
            },
            {
              "stage": "web_research",
              "timestamp": "2025-08-29T07:51:45.540Z",
              "type": "info",
              "content": "LLM-first research available, attempting direct ownership determination"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 36254,
            "stage_durations": {
              "cache_check": 745,
              "sheets_mapping": 682,
              "static_mapping": 783,
              "rag_retrieval": 819,
              "llm_first_analysis": 6913,
              "query_builder": 680,
              "web_research": 25632
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 0.4,
        "fallback_reason": null,
        "result_id": "query_1756453930497_bk9mpyv3z"
      },
      "issues": [
        "Pipeline reported failure"
      ],
      "observations": []
    },
    "CacheLookup": {
      "success": true,
      "result": {
        "cachedData": [],
        "error": null
      },
      "issues": [],
      "observations": [
        "Cache lookup successful: 0 records found"
      ]
    },
    "ConfidenceScoring": {
      "success": false,
      "error": "Cannot read properties of undefined (reading 'sources')"
    }
  },
  "traces": [
    {
      "name": "EnhancedAgentOwnershipResearch",
      "type": "agent_component",
      "expectedBehavior": "should find ownership data",
      "startTime": 1756453821023,
      "traces": [
        {
          "timestamp": 108,
          "level": "log",
          "message": "[WebResearchAgent] Environment check: [object Object]",
          "agent": "WebResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 978,
          "level": "log",
          "message": "[AgentLog] Starting: EnhancedAgentOwnershipResearch",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "start"
        },
        {
          "timestamp": 979,
          "level": "log",
          "message": "[EnhancedAgentOwnershipResearch] Starting research for: [object Object]",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 4489,
          "level": "log",
          "message": "[AgentLog] Starting: LookupOwnershipMapping",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 4693,
          "level": "log",
          "message": "[AgentLog] Completed: LookupOwnershipMapping (204ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 4693,
          "level": "log",
          "message": "%s: %s [AgentTimer] LookupOwnershipMapping 204.052ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 6164,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 6279,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (115ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 6279,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 114.396ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 7633,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 7722,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (89ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 7722,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 89.065ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 17700,
          "level": "log",
          "message": "[AgentLog] Starting: UpsertProduct",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 17797,
          "level": "log",
          "message": "\n❌ Test completed: EnhancedAgentOwnershipResearch",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "completed"
        },
        {
          "timestamp": 17797,
          "level": "log",
          "message": "⚠️  Issues: Agent reported failure",
          "agent": "System",
          "stage": "processing"
        }
      ],
      "result": {
        "financial_beneficiary": "Unilever PLC",
        "beneficiary_country": "United Kingdom",
        "beneficiary_flag": "🇬🇧",
        "ownership_structure_type": "Joint Venture",
        "confidence_score": 95,
        "confidence_level": "Very High",
        "sources": [
          "LLM analysis of Lipton"
        ],
        "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
        "ownership_flow": [
          {
            "name": "Lipton",
            "type": "Brand",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": false
          },
          {
            "name": "Pepsi Lipton International",
            "type": "Joint Venture",
            "country": "United States",
            "flag": "🇺🇸",
            "ultimate": false
          },
          {
            "name": "Unilever PLC",
            "type": "Ultimate Owner",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": true
          }
        ],
        "web_research_used": false,
        "web_sources_count": 0,
        "query_analysis_used": false,
        "static_mapping_used": false,
        "result_type": "llm_first_analysis",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453822001_yquiraa7b",
          "start_time": "2025-08-29T07:50:22.001Z",
          "brand": "Lipton",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453822003",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:50:22.003Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:22.761Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:50:22.761Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 758,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:22.761Z"
            },
            {
              "stage_id": "sheets_mapping_1756453823463",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:50:23.463Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:24.151Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:24.151Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 688,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:24.151Z"
            },
            {
              "stage_id": "static_mapping_1756453824828",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:50:24.828Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:25.512Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:25.716Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 888,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:25.716Z"
            },
            {
              "stage_id": "rag_retrieval_1756453826519",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:50:26.519Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:27.187Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:27.302Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 783,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:27.302Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453827974",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:50:27.974Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:28.656Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:38.047Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
                },
                "LLM-first analysis successful with high confidence"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:50:38.047Z",
                  "decision": "Use LLM-first result",
                  "alternatives": [
                    "Proceed with web research"
                  ],
                  "reasoning": "LLM analysis provides high-confidence result"
                }
              ],
              "data": {
                "financial_beneficiary": "Unilever PLC",
                "confidence_score": 95,
                "method": "llm_first_high_confidence"
              },
              "error": null,
              "duration_ms": 10073,
              "variables": {
                "inputVariables": {
                  "brand": "Lipton",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "Unilever PLC",
                  "beneficiary_country": "United Kingdom",
                  "ownership_structure_type": "Joint Venture",
                  "confidence_score": 95,
                  "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
                  "ownership_flow": [
                    {
                      "name": "Lipton",
                      "type": "Brand",
                      "country": "United Kingdom",
                      "source": "historical knowledge"
                    },
                    {
                      "name": "Pepsi Lipton International",
                      "type": "Joint Venture",
                      "country": "United States",
                      "source": "corporate filings"
                    },
                    {
                      "name": "Unilever PLC",
                      "type": "Ultimate Owner",
                      "country": "United Kingdom",
                      "source": "corporate structure records"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1543,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: Lipton\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:50:38.047Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:50:38.047Z",
              "decision": "Use LLM-first result",
              "alternatives": [
                "Proceed with web research"
              ],
              "reasoning": "LLM analysis provides high-confidence result"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:22.761Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:22.761Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:24.151Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: Lipton"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:24.151Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:25.512Z",
              "type": "info",
              "content": "Checking static mappings for brand: Lipton"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:25.716Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:50:27.187Z",
              "type": "info",
              "content": "Searching knowledge base for brand: Lipton"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:50:27.302Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:50:28.656Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: Lipton"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:50:38.047Z",
              "type": "analysis",
              "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 16819,
            "stage_durations": {
              "cache_check": 758,
              "sheets_mapping": 688,
              "static_mapping": 888,
              "rag_retrieval": 783,
              "llm_first_analysis": 10073
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 95,
        "agent_results": {
          "llm_first_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "Unilever PLC",
              "beneficiary_country": "United Kingdom",
              "ownership_structure_type": "Joint Venture",
              "ownership_flow": [
                {
                  "name": "Lipton",
                  "type": "Brand",
                  "country": "United Kingdom",
                  "source": "historical knowledge"
                },
                {
                  "name": "Pepsi Lipton International",
                  "type": "Joint Venture",
                  "country": "United States",
                  "source": "corporate filings"
                },
                {
                  "name": "Unilever PLC",
                  "type": "Ultimate Owner",
                  "country": "United Kingdom",
                  "source": "corporate structure records"
                }
              ],
              "confidence_score": 95,
              "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score."
            },
            "reasoning": "LLM-first analysis provided high-confidence ownership determination"
          }
        }
      },
      "duration": 17797,
      "issues": [
        "Agent reported failure"
      ],
      "observations": []
    },
    {
      "name": "EnhancedWebSearchOwnershipAgent",
      "type": "agent_component",
      "expectedBehavior": "should perform web search and return structured data",
      "startTime": 1756453838820,
      "traces": [
        {
          "timestamp": 17797,
          "level": "log",
          "message": "[AgentLog] Starting: EnhancedWebSearchOwnershipAgent",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "start"
        },
        {
          "timestamp": 17797,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Starting research for: [object Object]",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 17797,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Timeout config: [object Object]",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 17798,
          "level": "log",
          "message": "🔍 [EnhancedAgent] Attempt 1 for \"IKEA\"",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 17798,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 📊 Research parameters: [object Object]",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 17798,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Generating search queries...",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 17798,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 📝 Generated queries: [object Object]",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 17798,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🌐 Executing real web searches...",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 17798,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 1/10: \"\"IKEA\" parent company\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 18328,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" parent company\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 18328,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" parent company\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 18328,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 2/10: \"\"IKEA\" ultimate owner\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 18800,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" ultimate owner\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 18800,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" ultimate owner\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 18800,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 3/10: \"\"IKEA\" acquired by\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19082,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" acquired by\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19082,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" acquired by\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19082,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 4/10: \"\"IKEA\" owner site:wikipedia.org\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19490,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" owner site:wikipedia.org\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19490,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" owner site:wikipedia.org\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19490,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 5/10: \"\"IKEA\" corporate structure\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19690,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" corporate structure\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19690,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" corporate structure\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 19690,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 6/10: \"\"IKEA\" subsidiary of\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20087,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" subsidiary of\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20087,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" subsidiary of\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20087,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 7/10: \"\"IKEA\" owned by site:bloomberg.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20274,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" owned by site:bloomberg.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20274,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" owned by site:bloomberg.com\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20274,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 8/10: \"\"IKEA\" owned by site:reuters.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20487,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" owned by site:reuters.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20487,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" owned by site:reuters.com\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20487,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 9/10: \"\"IKEA\" owned by site:ft.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20888,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" owned by site:ft.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20888,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" owned by site:ft.com\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 20888,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🔍 Executing query 10/10: \"\"IKEA\" owned by site:wsj.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 21331,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Found 10 results for query: \"\"IKEA\" owned by site:wsj.com\"",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 21332,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Query \"\"IKEA\" owned by site:wsj.com\" found 10 results",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 21332,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 📊 Search execution summary: [object Object]",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 21332,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] 🤖 Analyzing sources with LLM...",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Enhanced LLM analysis completed",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "completed"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] ✅ Validating and structuring results...",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "❌ [EnhancedAgent] Attempt 1 failed: Cannot read properties of undefined (reading 'ownership_chain')",
          "agent": "System",
          "stage": "failed"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "❌ [EnhancedAgent] Non-transient error - not retrying",
          "agent": "System",
          "stage": "error"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "[EnhancedWebSearchOwnershipAgent] Research failed - returning null for fallback",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "failed"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "%s: %s [AgentTimer] EnhancedWebSearchOwnershipAgent 9.485s",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "processing"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "\n❌ Test completed: EnhancedWebSearchOwnershipAgent",
          "agent": "EnhancedWebSearchOwnershipAgent",
          "stage": "completed"
        },
        {
          "timestamp": 27282,
          "level": "log",
          "message": "⚠️  Issues: Agent returned null/undefined",
          "agent": "System",
          "stage": "processing"
        }
      ],
      "result": null,
      "success": null,
      "duration": 9485,
      "issues": [
        "Agent returned null/undefined"
      ],
      "observations": []
    },
    {
      "name": "NarrativeGeneratorV3",
      "type": "agent_component",
      "expectedBehavior": "should generate rich narrative content",
      "startTime": 1756453848305,
      "traces": [
        {
          "timestamp": 27288,
          "level": "log",
          "message": "[NARRATIVE_GEN_V3] Starting flexible narrative generation for: [object Object]",
          "agent": "NarrativeGenerator",
          "stage": "processing"
        },
        {
          "timestamp": 27289,
          "level": "log",
          "message": "[NARRATIVE_GEN_V3] Attempt 1/3 - Calling Anthropic API...",
          "agent": "NarrativeGenerator",
          "stage": "processing"
        },
        {
          "timestamp": 34468,
          "level": "log",
          "message": "[NARRATIVE_GEN_V3] LLM response: {\n  \"headline\": \"Your Lipton tea? Actually Dutch! 🇳🇱\",\n  \"tagline\": \"The famous tea brand is owned by Unilever in Netherlands\",\n  \"story\": \"That iconic yellow label tea brand isn't British or American as many think - Lipton is actually owned by Dutch-based consumer goods giant Unilever.\",\n  \"ownership_notes\": [\n    \"Unilever is a Dutch-British multinational company\",\n    \"Ownership confidence level: 85%\",\n    \"Lipton is one of Unilever's billion-dollar brands\"\n  ],\n  \"behind_the_scenes\": [\n    \"Original brand country data unavailable\",\n    \"Ownership type information not provided\",\n    \"High confidence (85%) in Unilever ownership\",\n    \"Netherlands identified as ultimate owner country\"\n  ],\n  \"template_used\": \"surprise_origin\"\n}",
          "agent": "NarrativeGenerator",
          "stage": "processing"
        },
        {
          "timestamp": 34469,
          "level": "log",
          "message": "[NARRATIVE_GEN_V3] Generated narrative: [object Object]",
          "agent": "NarrativeGenerator",
          "stage": "processing"
        },
        {
          "timestamp": 34469,
          "level": "log",
          "message": "\n✅ Test completed: NarrativeGeneratorV3",
          "agent": "System",
          "stage": "completed"
        }
      ],
      "result": {
        "headline": "Your Lipton tea? Actually Dutch! 🇳🇱",
        "tagline": "The famous tea brand is owned by Unilever in Netherlands",
        "story": "That iconic yellow label tea brand isn't British or American as many think - Lipton is actually owned by Dutch-based consumer goods giant Unilever.",
        "ownership_notes": [
          "Unilever is a Dutch-British multinational company",
          "Ownership confidence level: 85%",
          "Lipton is one of Unilever's billion-dollar brands"
        ],
        "behind_the_scenes": [
          "Original brand country data unavailable",
          "Ownership type information not provided",
          "High confidence (85%) in Unilever ownership",
          "Netherlands identified as ultimate owner country"
        ],
        "template_used": "surprise_origin"
      },
      "success": "That iconic yellow label tea brand isn't British or American as many think - Lipton is actually owned by Dutch-based consumer goods giant Unilever.",
      "duration": 7187,
      "issues": [],
      "observations": [
        "Headline: Your Lipton tea? Actually Dutch! 🇳🇱",
        "Template: surprise_origin",
        "Country emphasis: Yes"
      ]
    },
    {
      "name": "Manual_Lipton",
      "type": "manual_input",
      "expectedBehavior": "triggers disambiguation",
      "startTime": 1756453855492,
      "traces": [
        {
          "timestamp": 34469,
          "level": "log",
          "message": "[AgentLog] Starting: EnhancedAgentOwnershipResearch",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "start"
        },
        {
          "timestamp": 34469,
          "level": "log",
          "message": "[EnhancedAgentOwnershipResearch] Starting research for: [object Object]",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 34470,
          "level": "error",
          "message": "(node:96248) Warning: Label '[AgentTimer] EnhancedAgentOwnershipResearch' already exists for console.time()",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 37871,
          "level": "log",
          "message": "[AgentLog] Starting: LookupOwnershipMapping",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 37984,
          "level": "log",
          "message": "[AgentLog] Completed: LookupOwnershipMapping (113ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 37984,
          "level": "log",
          "message": "%s: %s [AgentTimer] LookupOwnershipMapping 112.619ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 39340,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 39456,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (116ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 39456,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 116.184ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 40820,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 40903,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (83ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 40904,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 82.946ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 51314,
          "level": "log",
          "message": "[AgentLog] Starting: UpsertProduct",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 51316,
          "level": "error",
          "message": "(node:96248) Warning: Label '[AgentTimer] UpsertProduct' already exists for console.time()",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 51408,
          "level": "log",
          "message": "\n❌ Test completed: Manual_Lipton",
          "agent": "System",
          "stage": "completed"
        },
        {
          "timestamp": 51408,
          "level": "log",
          "message": "⚠️  Issues: Pipeline reported failure",
          "agent": "System",
          "stage": "processing"
        }
      ],
      "result": {
        "financial_beneficiary": "Unilever PLC",
        "beneficiary_country": "United Kingdom",
        "beneficiary_flag": "🇬🇧",
        "ownership_structure_type": "Joint Venture",
        "confidence_score": 95,
        "confidence_level": "Very High",
        "sources": [
          "LLM analysis of Lipton"
        ],
        "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
        "ownership_flow": [
          {
            "name": "Lipton",
            "type": "Brand",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": false
          },
          {
            "name": "Pepsi Lipton International",
            "type": "Joint Venture",
            "country": "United States",
            "flag": "🇺🇸",
            "ultimate": false
          },
          {
            "name": "Unilever PLC",
            "type": "Ultimate Owner",
            "country": "United Kingdom",
            "flag": "🇬🇧",
            "ultimate": true
          }
        ],
        "web_research_used": false,
        "web_sources_count": 0,
        "query_analysis_used": false,
        "static_mapping_used": false,
        "result_type": "llm_first_analysis",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453855492_pxyfnhym3",
          "start_time": "2025-08-29T07:50:55.492Z",
          "brand": "Lipton",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453855492",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:50:55.492Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:56.170Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:50:56.170Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 678,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:56.170Z"
            },
            {
              "stage_id": "sheets_mapping_1756453856846",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:50:56.846Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:57.522Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:57.522Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 676,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:57.522Z"
            },
            {
              "stage_id": "static_mapping_1756453858206",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:50:58.206Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:50:58.894Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:50:59.007Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 801,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:50:59.007Z"
            },
            {
              "stage_id": "rag_retrieval_1756453859682",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:50:59.682Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:00.363Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:51:00.479Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 798,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:00.480Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453861164",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:51:01.164Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:01.843Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: Lipton"
                },
                {
                  "timestamp": "2025-08-29T07:51:11.653Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
                },
                "LLM-first analysis successful with high confidence"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:51:11.653Z",
                  "decision": "Use LLM-first result",
                  "alternatives": [
                    "Proceed with web research"
                  ],
                  "reasoning": "LLM analysis provides high-confidence result"
                }
              ],
              "data": {
                "financial_beneficiary": "Unilever PLC",
                "confidence_score": 95,
                "method": "llm_first_high_confidence"
              },
              "error": null,
              "duration_ms": 10489,
              "variables": {
                "inputVariables": {
                  "brand": "Lipton",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "Unilever PLC",
                  "beneficiary_country": "United Kingdom",
                  "ownership_structure_type": "Joint Venture",
                  "confidence_score": 95,
                  "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score.",
                  "ownership_flow": [
                    {
                      "name": "Lipton",
                      "type": "Brand",
                      "country": "United Kingdom",
                      "source": "historical knowledge"
                    },
                    {
                      "name": "Pepsi Lipton International",
                      "type": "Joint Venture",
                      "country": "United States",
                      "source": "corporate filings"
                    },
                    {
                      "name": "Unilever PLC",
                      "type": "Ultimate Owner",
                      "country": "United Kingdom",
                      "source": "corporate structure records"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1543,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: Lipton\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:51:11.653Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:11.653Z",
              "decision": "Use LLM-first result",
              "alternatives": [
                "Proceed with web research"
              ],
              "reasoning": "LLM analysis provides high-confidence result"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:56.170Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:50:56.170Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:57.522Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: Lipton"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:50:57.522Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:58.894Z",
              "type": "info",
              "content": "Checking static mappings for brand: Lipton"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:50:59.007Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:00.363Z",
              "type": "info",
              "content": "Searching knowledge base for brand: Lipton"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:00.479Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:01.843Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: Lipton"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:11.653Z",
              "type": "analysis",
              "content": "LLM analysis complete: Unilever PLC (confidence: 95%)"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 16939,
            "stage_durations": {
              "cache_check": 678,
              "sheets_mapping": 676,
              "static_mapping": 801,
              "rag_retrieval": 798,
              "llm_first_analysis": 10489
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 95,
        "agent_results": {
          "llm_first_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "Unilever PLC",
              "beneficiary_country": "United Kingdom",
              "ownership_structure_type": "Joint Venture",
              "ownership_flow": [
                {
                  "name": "Lipton",
                  "type": "Brand",
                  "country": "United Kingdom",
                  "source": "historical knowledge"
                },
                {
                  "name": "Pepsi Lipton International",
                  "type": "Joint Venture",
                  "country": "United States",
                  "source": "corporate filings"
                },
                {
                  "name": "Unilever PLC",
                  "type": "Ultimate Owner",
                  "country": "United Kingdom",
                  "source": "corporate structure records"
                }
              ],
              "confidence_score": 95,
              "reasoning": "Lipton has a complex ownership structure. While the brand was originally founded by Thomas Lipton in 1890, it was acquired by Unilever in 1938. In 1991, Unilever entered into a joint venture with PepsiCo to sell ready-to-drink tea products in North America and internationally through Pepsi Lipton International (PLI). However, Unilever maintains ownership of the Lipton brand globally and is the ultimate financial beneficiary. The tea business operations were historically part of Unilever until 2021 when Unilever sold most of its tea business (ekaterra) to CVC Capital Partners, but retained the Lipton brand and its partnerships. The joint venture with PepsiCo continues for ready-to-drink products, while Unilever maintains control of the brand and other tea products. This structure is well-documented through corporate filings and business news, leading to a high confidence score."
            },
            "reasoning": "LLM-first analysis provided high-confidence ownership determination"
          }
        }
      },
      "duration": 16939,
      "issues": [
        "Pipeline reported failure"
      ],
      "observations": []
    },
    {
      "name": "Manual_IKEA",
      "type": "manual_input",
      "expectedBehavior": "direct ownership resolution",
      "startTime": 1756453872431,
      "traces": [
        {
          "timestamp": 51408,
          "level": "log",
          "message": "[AgentLog] Starting: EnhancedAgentOwnershipResearch",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "start"
        },
        {
          "timestamp": 51408,
          "level": "log",
          "message": "[EnhancedAgentOwnershipResearch] Starting research for: [object Object]",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 51408,
          "level": "error",
          "message": "(node:96248) Warning: Label '[AgentTimer] EnhancedAgentOwnershipResearch' already exists for console.time()",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 54785,
          "level": "log",
          "message": "[AgentLog] Starting: LookupOwnershipMapping",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 54872,
          "level": "log",
          "message": "[AgentLog] Completed: LookupOwnershipMapping (87ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 54872,
          "level": "log",
          "message": "%s: %s [AgentTimer] LookupOwnershipMapping 87.096ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 56234,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 56338,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (104ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 56338,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 104.295ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 57725,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 57845,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (120ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 57845,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 120.022ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 69076,
          "level": "log",
          "message": "[AgentLog] Starting: UpsertProduct",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 69078,
          "level": "error",
          "message": "(node:96248) Warning: Label '[AgentTimer] UpsertProduct' already exists for console.time()",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 69154,
          "level": "log",
          "message": "\n❌ Test completed: Manual_IKEA",
          "agent": "System",
          "stage": "completed"
        },
        {
          "timestamp": 69154,
          "level": "log",
          "message": "⚠️  Issues: Pipeline reported failure",
          "agent": "System",
          "stage": "processing"
        }
      ],
      "result": {
        "financial_beneficiary": "INGKA Foundation",
        "beneficiary_country": "Netherlands",
        "beneficiary_flag": "🇳🇱",
        "ownership_structure_type": "Foundation-owned Private Company",
        "confidence_score": 95,
        "confidence_level": "Very High",
        "sources": [
          "LLM analysis of IKEA"
        ],
        "reasoning": "IKEA has a complex ownership structure split between two main entities: The INGKA Foundation (which owns INGKA Holding B.V., operating most IKEA stores) and the Interogo Foundation (which owns the IKEA concept and brand rights through Inter IKEA Systems B.V.). The INGKA Foundation is considered the ultimate financial beneficiary as it controls the majority of IKEA's retail operations worldwide, representing about 90% of all IKEA stores. This structure was created by IKEA's founder Ingvar Kamprad for tax efficiency and to ensure long-term independence. The high confidence score is based on well-documented corporate structures and public records, though the complex nature of the organization means some details of internal ownership flows may vary.",
        "ownership_flow": [
          {
            "name": "IKEA",
            "type": "Brand",
            "country": "Sweden",
            "flag": "🇸🇪",
            "ultimate": false
          },
          {
            "name": "Inter IKEA Systems B.V.",
            "type": "Brand Owner",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": false
          },
          {
            "name": "Inter IKEA Holding B.V.",
            "type": "Parent Company",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": false
          },
          {
            "name": "Interogo Foundation",
            "type": "Brand Rights Owner",
            "country": "Liechtenstein",
            "flag": "🏳️",
            "ultimate": false
          },
          {
            "name": "INGKA Holding B.V.",
            "type": "Retail Operations",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": false
          },
          {
            "name": "INGKA Foundation",
            "type": "Ultimate Owner",
            "country": "Netherlands",
            "flag": "🇳🇱",
            "ultimate": true
          }
        ],
        "web_research_used": false,
        "web_sources_count": 0,
        "query_analysis_used": false,
        "static_mapping_used": false,
        "result_type": "llm_first_analysis",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453872431_ltczhujvz",
          "start_time": "2025-08-29T07:51:12.431Z",
          "brand": "IKEA",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453872431",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:51:12.431Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:13.115Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:51:13.115Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 684,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:13.115Z"
            },
            {
              "stage_id": "sheets_mapping_1756453873790",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:51:13.790Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:14.459Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:14.459Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 669,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:14.459Z"
            },
            {
              "stage_id": "static_mapping_1756453875128",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:51:15.128Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:15.808Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:15.895Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 767,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:15.895Z"
            },
            {
              "stage_id": "rag_retrieval_1756453876573",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:51:16.573Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:17.257Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:17.361Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 788,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:17.361Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453878075",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:51:18.075Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:18.748Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: IKEA"
                },
                {
                  "timestamp": "2025-08-29T07:51:29.434Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: INGKA Foundation (confidence: 95%)"
                },
                "LLM-first analysis successful with high confidence"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:51:29.434Z",
                  "decision": "Use LLM-first result",
                  "alternatives": [
                    "Proceed with web research"
                  ],
                  "reasoning": "LLM analysis provides high-confidence result"
                }
              ],
              "data": {
                "financial_beneficiary": "INGKA Foundation",
                "confidence_score": 95,
                "method": "llm_first_high_confidence"
              },
              "error": null,
              "duration_ms": 11359,
              "variables": {
                "inputVariables": {
                  "brand": "IKEA",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "INGKA Foundation",
                  "beneficiary_country": "Netherlands",
                  "ownership_structure_type": "Foundation-owned Private Company",
                  "confidence_score": 95,
                  "reasoning": "IKEA has a complex ownership structure split between two main entities: The INGKA Foundation (which owns INGKA Holding B.V., operating most IKEA stores) and the Interogo Foundation (which owns the IKEA concept and brand rights through Inter IKEA Systems B.V.). The INGKA Foundation is considered the ultimate financial beneficiary as it controls the majority of IKEA's retail operations worldwide, representing about 90% of all IKEA stores. This structure was created by IKEA's founder Ingvar Kamprad for tax efficiency and to ensure long-term independence. The high confidence score is based on well-documented corporate structures and public records, though the complex nature of the organization means some details of internal ownership flows may vary.",
                  "ownership_flow": [
                    {
                      "name": "IKEA",
                      "type": "Brand",
                      "country": "Sweden",
                      "source": "public records"
                    },
                    {
                      "name": "Inter IKEA Systems B.V.",
                      "type": "Brand Owner",
                      "country": "Netherlands",
                      "source": "corporate filings"
                    },
                    {
                      "name": "Inter IKEA Holding B.V.",
                      "type": "Parent Company",
                      "country": "Netherlands",
                      "source": "corporate structure documents"
                    },
                    {
                      "name": "Interogo Foundation",
                      "type": "Brand Rights Owner",
                      "country": "Liechtenstein",
                      "source": "corporate records"
                    },
                    {
                      "name": "INGKA Holding B.V.",
                      "type": "Retail Operations",
                      "country": "Netherlands",
                      "source": "corporate filings"
                    },
                    {
                      "name": "INGKA Foundation",
                      "type": "Ultimate Owner",
                      "country": "Netherlands",
                      "source": "corporate records"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1871,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: IKEA\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:51:29.434Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:29.434Z",
              "decision": "Use LLM-first result",
              "alternatives": [
                "Proceed with web research"
              ],
              "reasoning": "LLM analysis provides high-confidence result"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:13.115Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:13.115Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:14.459Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: IKEA"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:14.459Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:15.808Z",
              "type": "info",
              "content": "Checking static mappings for brand: IKEA"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:15.895Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:17.257Z",
              "type": "info",
              "content": "Searching knowledge base for brand: IKEA"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:17.361Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:18.748Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: IKEA"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:29.434Z",
              "type": "analysis",
              "content": "LLM analysis complete: INGKA Foundation (confidence: 95%)"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 17746,
            "stage_durations": {
              "cache_check": 684,
              "sheets_mapping": 669,
              "static_mapping": 767,
              "rag_retrieval": 788,
              "llm_first_analysis": 11359
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 95,
        "agent_results": {
          "llm_first_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "INGKA Foundation",
              "beneficiary_country": "Netherlands",
              "ownership_structure_type": "Foundation-owned Private Company",
              "ownership_flow": [
                {
                  "name": "IKEA",
                  "type": "Brand",
                  "country": "Sweden",
                  "source": "public records"
                },
                {
                  "name": "Inter IKEA Systems B.V.",
                  "type": "Brand Owner",
                  "country": "Netherlands",
                  "source": "corporate filings"
                },
                {
                  "name": "Inter IKEA Holding B.V.",
                  "type": "Parent Company",
                  "country": "Netherlands",
                  "source": "corporate structure documents"
                },
                {
                  "name": "Interogo Foundation",
                  "type": "Brand Rights Owner",
                  "country": "Liechtenstein",
                  "source": "corporate records"
                },
                {
                  "name": "INGKA Holding B.V.",
                  "type": "Retail Operations",
                  "country": "Netherlands",
                  "source": "corporate filings"
                },
                {
                  "name": "INGKA Foundation",
                  "type": "Ultimate Owner",
                  "country": "Netherlands",
                  "source": "corporate records"
                }
              ],
              "confidence_score": 95,
              "reasoning": "IKEA has a complex ownership structure split between two main entities: The INGKA Foundation (which owns INGKA Holding B.V., operating most IKEA stores) and the Interogo Foundation (which owns the IKEA concept and brand rights through Inter IKEA Systems B.V.). The INGKA Foundation is considered the ultimate financial beneficiary as it controls the majority of IKEA's retail operations worldwide, representing about 90% of all IKEA stores. This structure was created by IKEA's founder Ingvar Kamprad for tax efficiency and to ensure long-term independence. The high confidence score is based on well-documented corporate structures and public records, though the complex nature of the organization means some details of internal ownership flows may vary."
            },
            "reasoning": "LLM-first analysis provided high-confidence ownership determination"
          }
        }
      },
      "duration": 17746,
      "issues": [
        "Pipeline reported failure"
      ],
      "observations": []
    },
    {
      "name": "Manual_MooseMilk",
      "type": "manual_input",
      "expectedBehavior": "triggers fallback mechanisms",
      "startTime": 1756453890177,
      "traces": [
        {
          "timestamp": 69154,
          "level": "log",
          "message": "[AgentLog] Starting: EnhancedAgentOwnershipResearch",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "start"
        },
        {
          "timestamp": 69154,
          "level": "log",
          "message": "[EnhancedAgentOwnershipResearch] Starting research for: [object Object]",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 69155,
          "level": "error",
          "message": "(node:96248) Warning: Label '[AgentTimer] EnhancedAgentOwnershipResearch' already exists for console.time()",
          "agent": "EnhancedAgentOwnershipResearch",
          "stage": "processing"
        },
        {
          "timestamp": 72605,
          "level": "log",
          "message": "[AgentLog] Starting: LookupOwnershipMapping",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 72706,
          "level": "log",
          "message": "[AgentLog] Completed: LookupOwnershipMapping (101ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 72706,
          "level": "log",
          "message": "%s: %s [AgentTimer] LookupOwnershipMapping 100.488ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 74079,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 74217,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (138ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 74217,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 138.112ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 75563,
          "level": "log",
          "message": "[AgentLog] Starting: RAGKnowledgeBaseSearch",
          "agent": "System",
          "stage": "start"
        },
        {
          "timestamp": 75689,
          "level": "log",
          "message": "[AgentLog] Completed: RAGKnowledgeBaseSearch (126ms)",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 75689,
          "level": "log",
          "message": "%s: %s [AgentTimer] RAGKnowledgeBaseSearch 126.013ms",
          "agent": "System",
          "stage": "processing"
        },
        {
          "timestamp": 84518,
          "level": "log",
          "message": "[LLMResearchAgent] 🚀 Starting LLM-first research for: [object Object]",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 90783,
          "level": "log",
          "message": "[LLMResearchAgent] 📊 Context hints: [object Object]",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 90785,
          "level": "log",
          "message": "[LLMResearchAgent] 🎯 Research strategy: [object Object]",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 90785,
          "level": "log",
          "message": "[LLMResearchAgent] 🔍 Round 1: Registry research",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 96663,
          "level": "log",
          "message": "[LLMResearchAgent] 🔍 Round 2: News research",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 102296,
          "level": "log",
          "message": "[LLMResearchAgent] 🔍 Round 3: Fallback research",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 109474,
          "level": "log",
          "message": "[LLMResearchAgent] 📈 Research results: [object Object]",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 109474,
          "level": "log",
          "message": "[LLMResearchAgent] ✅ Research complete: [object Object]",
          "agent": "LLMResearchAgent",
          "stage": "processing"
        },
        {
          "timestamp": 109474,
          "level": "log",
          "message": "[EnhancedAgent] ✅ Using LLM research result as final output, skipping fallback.",
          "agent": "System",
          "stage": "fallback"
        },
        {
          "timestamp": 109475,
          "level": "log",
          "message": "\n❌ Test completed: Manual_MooseMilk",
          "agent": "System",
          "stage": "completed"
        },
        {
          "timestamp": 109475,
          "level": "log",
          "message": "⚠️  Issues: Pipeline reported failure",
          "agent": "System",
          "stage": "processing"
        }
      ],
      "result": {
        "financial_beneficiary": "MooseMilk",
        "beneficiary_country": "Canada",
        "beneficiary_flag": "🇨🇦",
        "ownership_structure_type": "Independent Brand",
        "ownership_flow": [
          {
            "name": "MooseMilk",
            "type": "Brand",
            "country": "Canada",
            "source": "web_search_analysis"
          }
        ],
        "confidence_score": 50,
        "confidence_level": "Medium",
        "confidence_factors": {
          "source_authority": 0,
          "source_recency": 0,
          "source_count": 0,
          "chain_completeness": 1
        },
        "confidence_breakdown": {
          "tier_1_sources": 0,
          "tier_2_sources": 0,
          "tier_3_sources": 0,
          "tier_4_sources": 0
        },
        "confidence_reasoning": "Based on 0 sources across 1 ownership levels",
        "sources": [],
        "reasoning": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information.",
        "verification_status": "unverified",
        "verification_reasoning": "Found 2 sources with 0 verified sources",
        "trusted_sources": [],
        "verified_sources": [],
        "highly_likely_sources": [],
        "agent_results": {
          "query_builder": {
            "success": true,
            "data": [
              {
                "query": "\"[object Object]\" parent company",
                "purpose": "find parent company information",
                "priority": 5,
                "expected_sources": [
                  "company websites",
                  "financial news"
                ]
              },
              {
                "query": "\"[object Object]\" ultimate owner",
                "purpose": "find ultimate ownership",
                "priority": 5,
                "expected_sources": [
                  "financial filings",
                  "corporate registries"
                ]
              }
            ],
            "reasoning": "Query builder analyzed brand characteristics and generated optimized search queries"
          },
          "web_research": {
            "success": true,
            "data": {
              "success": true,
              "brand": "MooseMilk",
              "product_name": null,
              "ownership_chain": [
                {
                  "name": "MooseMilk",
                  "role": "Brand",
                  "country": "Canada",
                  "flag": "🇨🇦",
                  "ultimate": false,
                  "sources": []
                }
              ],
              "final_confidence": 0.4,
              "sources": [
                {
                  "name": "Canadian Brand Association Database",
                  "url": "",
                  "type": "inference",
                  "reliability": 0.3
                },
                {
                  "name": "Dairy Industry Analysis",
                  "url": "",
                  "type": "analysis",
                  "reliability": 0.4
                }
              ],
              "verification_status": "unverified",
              "verification_reasoning": "Found 2 sources with 0 verified sources",
              "research_summary": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information.",
              "data_quality": {
                "completeness": 0.5,
                "recency": 0.5,
                "consistency": 0.5
              },
              "debug_info": {
                "research_rounds": 3,
                "best_round": "fallback_research",
                "strategy_used": {
                  "primary_approach": "registry_research",
                  "secondary_approaches": [
                    "news_research",
                    "corporate_structure"
                  ],
                  "language_priority": [
                    "en"
                  ],
                  "registry_focus": [],
                  "legal_suffixes": [
                    "Ltd",
                    "Inc",
                    "LLC"
                  ],
                  "industry_keywords": [
                    "beverage",
                    "dairy",
                    "food and drink"
                  ]
                }
              },
              "research_method": "llm_first_research",
              "total_sources": 2,
              "notes": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information.",
              "trusted_sources": [],
              "verified_sources": [],
              "highly_likely_sources": []
            },
            "reasoning": "LLM-first research provided high-confidence ownership determination"
          },
          "ownership_analysis": {
            "success": true,
            "data": {
              "financial_beneficiary": "MooseMilk",
              "beneficiary_country": "Canada",
              "ownership_structure_type": "Independent Brand",
              "confidence_score": 50,
              "ownership_flow": [
                {
                  "name": "MooseMilk",
                  "type": "Brand",
                  "country": "Canada",
                  "source": "web_search_analysis"
                }
              ],
              "sources": [],
              "reasoning": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information."
            },
            "reasoning": "Ownership analysis completed using LLM research results"
          }
        },
        "web_research_used": true,
        "web_sources_count": 2,
        "query_analysis_used": true,
        "query_analysis": {},
        "static_mapping_used": false,
        "result_type": "llm_first_research",
        "cached": false,
        "agent_execution_trace": {
          "trace_id": "query_1756453890177_922a30eu5",
          "start_time": "2025-08-29T07:51:30.177Z",
          "brand": "MooseMilk",
          "product_name": null,
          "barcode": null,
          "stages": [
            {
              "stage_id": "cache_check_1756453890178",
              "stage": "cache_check",
              "description": "Checking for existing cached result",
              "start_time": "2025-08-29T07:51:30.178Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:30.923Z",
                  "type": "info",
                  "content": "Checking database for existing product record"
                },
                {
                  "timestamp": "2025-08-29T07:51:30.923Z",
                  "type": "info",
                  "content": "No cached result found, proceeding with research"
                },
                "No cached result available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 745,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:30.923Z"
            },
            {
              "stage_id": "sheets_mapping_1756453891588",
              "stage": "sheets_mapping",
              "description": "Checking Google Sheets ownership mappings",
              "start_time": "2025-08-29T07:51:31.588Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:32.270Z",
                  "type": "info",
                  "content": "Checking Google Sheets ownership mappings for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:32.270Z",
                  "type": "info",
                  "content": "No Google Sheets mapping found, proceeding with static mapping check"
                },
                "No Google Sheets mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 682,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:32.270Z"
            },
            {
              "stage_id": "static_mapping_1756453892946",
              "stage": "static_mapping",
              "description": "Checking static ownership mappings",
              "start_time": "2025-08-29T07:51:32.946Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:33.628Z",
                  "type": "info",
                  "content": "Checking static mappings for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:33.729Z",
                  "type": "info",
                  "content": "No static mapping found, proceeding with AI research"
                },
                "No static mapping available"
              ],
              "decisions": [],
              "data": {
                "result": "miss"
              },
              "error": null,
              "duration_ms": 783,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:33.729Z"
            },
            {
              "stage_id": "rag_retrieval_1756453894421",
              "stage": "rag_retrieval",
              "description": "Searching knowledge base for similar ownership patterns",
              "start_time": "2025-08-29T07:51:34.421Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:35.102Z",
                  "type": "info",
                  "content": "Searching knowledge base for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:35.240Z",
                  "type": "info",
                  "content": "No similar entries found in knowledge base"
                },
                "Knowledge base search completed"
              ],
              "decisions": [],
              "data": {
                "result": "no_matches"
              },
              "error": null,
              "duration_ms": 819,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:35.240Z"
            },
            {
              "stage_id": "llm_first_analysis_1756453895913",
              "stage": "llm_first_analysis",
              "description": "Attempting initial LLM analysis of brand ownership",
              "start_time": "2025-08-29T07:51:35.913Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:36.586Z",
                  "type": "info",
                  "content": "Attempting LLM-first analysis for brand: MooseMilk"
                },
                {
                  "timestamp": "2025-08-29T07:51:42.826Z",
                  "type": "analysis",
                  "content": "LLM analysis complete: Unknown (confidence: 0%)"
                },
                {
                  "timestamp": "2025-08-29T07:51:42.826Z",
                  "type": "decision",
                  "content": "LLM confidence too low (0%), proceeding with web research"
                },
                "LLM-first analysis completed, proceeding with web research"
              ],
              "decisions": [
                {
                  "timestamp": "2025-08-29T07:51:42.826Z",
                  "decision": "Proceed with web research",
                  "alternatives": [
                    "Use LLM result"
                  ],
                  "reasoning": "LLM confidence insufficient for direct use"
                }
              ],
              "data": {
                "confidence_score": 0,
                "method": "llm_first_low_confidence",
                "llm_insights": {
                  "financial_beneficiary": "Unknown",
                  "beneficiary_country": "Unknown",
                  "ownership_structure_type": "Unknown",
                  "ownership_flow": [
                    {
                      "name": "MooseMilk",
                      "type": "Brand",
                      "country": "Unknown",
                      "source": "provided information"
                    }
                  ],
                  "confidence_score": 0,
                  "reasoning": "With only the brand name 'MooseMilk' provided and no additional context, product information, or barcode data, I cannot make any confident assertions about the ownership structure or ultimate financial beneficiary. The brand name suggests it might be related to dairy products and possibly of Canadian origin (due to the moose reference), but this would be pure speculation. Without additional information such as product packaging, corporate registration data, or verifiable market presence, I cannot determine the ownership structure or parent company. A thorough analysis would require more data points such as manufacturing location, distribution networks, trademark registrations, or corporate filings."
                }
              },
              "error": null,
              "duration_ms": 6913,
              "variables": {
                "inputVariables": {
                  "brand": "MooseMilk",
                  "product_name": "Unknown product",
                  "barcode": null,
                  "hints": "{}",
                  "rag_context": ""
                },
                "outputVariables": {
                  "financial_beneficiary": "Unknown",
                  "beneficiary_country": "Unknown",
                  "ownership_structure_type": "Unknown",
                  "confidence_score": 0,
                  "reasoning": "With only the brand name 'MooseMilk' provided and no additional context, product information, or barcode data, I cannot make any confident assertions about the ownership structure or ultimate financial beneficiary. The brand name suggests it might be related to dairy products and possibly of Canadian origin (due to the moose reference), but this would be pure speculation. Without additional information such as product packaging, corporate registration data, or verifiable market presence, I cannot determine the ownership structure or parent company. A thorough analysis would require more data points such as manufacturing location, distribution networks, trademark registrations, or corporate filings.",
                  "ownership_flow": [
                    {
                      "name": "MooseMilk",
                      "type": "Brand",
                      "country": "Unknown",
                      "source": "provided information"
                    }
                  ]
                },
                "intermediateVariables": {
                  "rag_context_count": 0,
                  "llm_response_length": 1024,
                  "json_parse_success": true
                }
              },
              "config": {
                "model": "claude-3-5-sonnet-20241022",
                "temperature": 0.1,
                "maxTokens": 1000,
                "stopSequences": null
              },
              "compiled_prompt": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: MooseMilk\nProduct: Unknown product\nBarcode: null\nAdditional hints: {}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "prompt_template": "You are an expert corporate ownership researcher. Analyze the following brand and product to determine the ultimate financial beneficiary (parent company or owner), and provide a detailed ownership chain if possible.\n\nBrand: {{brand}}\nProduct: {{product_name}}\nBarcode: {{barcode}}\nAdditional hints: {{hints}}\n{{rag_context}}\n\nBased on your knowledge of corporate structures and brand ownership, provide a detailed analysis:\n\n1. **Financial Beneficiary**: The ultimate parent company or owner\n2. **Ownership Structure Type**: The type of ownership structure (e.g., \"Public Company\", \"Private Company\", \"Subsidiary\", \"Joint Venture\", \"Franchise\", \"Licensed Brand\", etc.)\n3. **Ownership Flow**: A detailed chain showing the ownership structure from brand to ultimate owner, including intermediate companies if known\n4. **Confidence Score**: Your confidence in this analysis (0-100)\n5. **Reasoning**: Detailed explanation of your analysis and reasoning\n6. **Country**: The country of the ultimate financial beneficiary\n\nFor the ownership flow, provide an array of objects with:\n- name: Company name\n- type: Role in ownership chain (e.g., \"Brand\", \"Subsidiary\", \"Parent Company\", \"Ultimate Owner\")\n- country: Country of incorporation/operation\n- source: How you know this information\n\nRespond in valid JSON format:\n{\n  \"financial_beneficiary\": \"Company Name\",\n  \"beneficiary_country\": \"Country\",\n  \"ownership_structure_type\": \"Structure Type\",\n  \"ownership_flow\": [\n    {\"name\": \"Brand Name\", \"type\": \"Brand\", \"country\": \"Country\", \"source\": \"knowledge\"},\n    {\"name\": \"Parent Company\", \"type\": \"Parent Company\", \"country\": \"Country\", \"source\": \"knowledge\"}\n  ],\n  \"confidence_score\": 85,\n  \"reasoning\": \"Detailed explanation of analysis...\"\n}",
              "end_time": "2025-08-29T07:51:42.826Z"
            },
            {
              "stage_id": "query_builder_1756453903507",
              "stage": "query_builder",
              "description": "Analyzing brand for optimal search queries",
              "start_time": "2025-08-29T07:51:43.507Z",
              "status": "error",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:44.185Z",
                  "type": "info",
                  "content": "Query builder available, generating optimized search queries"
                },
                {
                  "timestamp": "2025-08-29T07:51:44.187Z",
                  "type": "error",
                  "content": "Query builder failed: Cannot read properties of undefined (reading 'length')"
                },
                "Error: Cannot read properties of undefined (reading 'length')",
                "Query builder encountered an error"
              ],
              "decisions": [],
              "data": {},
              "error": null,
              "duration_ms": 680,
              "variables": {
                "inputVariables": {},
                "outputVariables": {},
                "intermediateVariables": {}
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:51:44.187Z"
            },
            {
              "stage_id": "web_research_1756453904865",
              "stage": "web_research",
              "description": "Performing LLM-first ownership research",
              "start_time": "2025-08-29T07:51:44.865Z",
              "status": "success",
              "reasoning": [
                {
                  "timestamp": "2025-08-29T07:51:45.540Z",
                  "type": "info",
                  "content": "LLM-first research available, attempting direct ownership determination"
                },
                "LLM-first research completed successfully"
              ],
              "decisions": [],
              "data": {
                "success": true,
                "total_sources": 2,
                "ownership_chain_length": 1,
                "final_confidence": 0.4,
                "research_method": "llm_first_research"
              },
              "error": null,
              "duration_ms": 25632,
              "variables": {
                "inputVariables": {
                  "brand": "MooseMilk",
                  "product_name": "Unknown product",
                  "hints": "{}",
                  "query_analysis": "[{\"query\":\"\\\"[object Object]\\\" parent company\",\"purpose\":\"find parent company information\",\"priority\":5,\"expected_sources\":[\"company websites\",\"financial news\"]},{\"query\":\"\\\"[object Object]\\\" ultimate owner\",\"purpose\":\"find ultimate ownership\",\"priority\":5,\"expected_sources\":[\"financial filings\",\"corporate registries\"]}]"
                },
                "outputVariables": {
                  "success": true,
                  "total_sources": 2,
                  "ownership_chain_length": 1,
                  "final_confidence": 0.4,
                  "research_method": "llm_first_research",
                  "notes": "Limited verifiable information found about MooseMilk ownership. Based on name and dairy industry patterns, likely a Canadian brand but unable to confirm specific ownership structure. The term suggests a Canadian-themed dairy product, but without additional context or specific product details, ownership cannot be definitively established. Research is significantly constrained by lack of specific identifiers or product information."
                },
                "intermediateVariables": {
                  "llm_research_available": true,
                  "evidence_tracked": 2
                }
              },
              "config": {
                "model": null,
                "temperature": null,
                "maxTokens": null,
                "stopSequences": null
              },
              "compiled_prompt": null,
              "prompt_template": null,
              "end_time": "2025-08-29T07:52:10.497Z"
            }
          ],
          "decisions": [
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:42.826Z",
              "decision": "Proceed with web research",
              "alternatives": [
                "Use LLM result"
              ],
              "reasoning": "LLM confidence insufficient for direct use"
            }
          ],
          "reasoning_chain": [
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:30.923Z",
              "type": "info",
              "content": "Checking database for existing product record"
            },
            {
              "stage": "cache_check",
              "timestamp": "2025-08-29T07:51:30.923Z",
              "type": "info",
              "content": "No cached result found, proceeding with research"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:32.270Z",
              "type": "info",
              "content": "Checking Google Sheets ownership mappings for brand: MooseMilk"
            },
            {
              "stage": "sheets_mapping",
              "timestamp": "2025-08-29T07:51:32.270Z",
              "type": "info",
              "content": "No Google Sheets mapping found, proceeding with static mapping check"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:33.628Z",
              "type": "info",
              "content": "Checking static mappings for brand: MooseMilk"
            },
            {
              "stage": "static_mapping",
              "timestamp": "2025-08-29T07:51:33.729Z",
              "type": "info",
              "content": "No static mapping found, proceeding with AI research"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:35.102Z",
              "type": "info",
              "content": "Searching knowledge base for brand: MooseMilk"
            },
            {
              "stage": "rag_retrieval",
              "timestamp": "2025-08-29T07:51:35.240Z",
              "type": "info",
              "content": "No similar entries found in knowledge base"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:36.586Z",
              "type": "info",
              "content": "Attempting LLM-first analysis for brand: MooseMilk"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:42.826Z",
              "type": "analysis",
              "content": "LLM analysis complete: Unknown (confidence: 0%)"
            },
            {
              "stage": "llm_first_analysis",
              "timestamp": "2025-08-29T07:51:42.826Z",
              "type": "decision",
              "content": "LLM confidence too low (0%), proceeding with web research"
            },
            {
              "stage": "query_builder",
              "timestamp": "2025-08-29T07:51:44.185Z",
              "type": "info",
              "content": "Query builder available, generating optimized search queries"
            },
            {
              "stage": "query_builder",
              "timestamp": "2025-08-29T07:51:44.187Z",
              "type": "error",
              "content": "Query builder failed: Cannot read properties of undefined (reading 'length')"
            },
            {
              "stage": "web_research",
              "timestamp": "2025-08-29T07:51:45.540Z",
              "type": "info",
              "content": "LLM-first research available, attempting direct ownership determination"
            }
          ],
          "performance_metrics": {
            "total_duration_ms": 36254,
            "stage_durations": {
              "cache_check": 745,
              "sheets_mapping": 682,
              "static_mapping": 783,
              "rag_retrieval": 819,
              "llm_first_analysis": 6913,
              "query_builder": 680,
              "web_research": 25632
            },
            "memory_usage": null,
            "api_calls": 0,
            "token_usage": 0
          },
          "final_result": null,
          "error_details": null,
          "confidence_evolution": []
        },
        "initial_llm_confidence": 0.4,
        "fallback_reason": null,
        "result_id": "query_1756453930497_bk9mpyv3z"
      },
      "duration": 40321,
      "issues": [
        "Pipeline reported failure"
      ],
      "observations": []
    },
    {
      "name": "CacheLookup",
      "type": "orchestrator",
      "expectedBehavior": "should check cache first and return cached results when available",
      "startTime": 1756453930498,
      "traces": [
        {
          "timestamp": 109580,
          "level": "log",
          "message": "\n✅ Test completed: CacheLookup",
          "agent": "CacheLookup",
          "stage": "completed"
        }
      ],
      "result": {
        "cachedData": [],
        "error": null
      },
      "success": true,
      "duration": 105,
      "issues": [],
      "observations": [
        "Cache lookup successful: 0 records found"
      ]
    },
    {
      "name": "ConfidenceScoring",
      "type": "orchestrator",
      "expectedBehavior": "should calculate and apply confidence thresholds",
      "startTime": 1756453930604,
      "traces": [
        {
          "timestamp": 109582,
          "level": "log",
          "message": "\n❌ Test completed: ConfidenceScoring",
          "agent": "System",
          "stage": "completed"
        },
        {
          "timestamp": 109582,
          "level": "log",
          "message": "⚠️  Issues: Error: Cannot read properties of undefined (reading 'sources')",
          "agent": "System",
          "stage": "processing"
        }
      ],
      "result": null,
      "success": false,
      "duration": 1,
      "issues": [
        "Error: Cannot read properties of undefined (reading 'sources')"
      ],
      "observations": []
    }
  ]
}